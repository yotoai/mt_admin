<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link href="__PUBLIC__/css/H-ui.min.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/css/H-ui.admin.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/lib/icheck/icheck.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/lib/Hui-iconfont/1.0.7/iconfont.css" rel="stylesheet" type="text/css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<title>个人中心</title>
</head>
<body>
<div class="pd-20">
    <div id="tab-system" class="HuiTab">
        <div class="tabBar cl">
            <span>编辑信息</span>
            <span>密码重置</span>
        </div>
        <div class="tabCon">
            <form class="form form-horizontal" id="form-admin-edit">
            <div class="row cl">
                <label class="form-label col-2"><span class="c-red">*</span>管理员：</label>
                <div class="formControls col-5">
                    <input type="hidden" name="id" value="{$aList.id}">
                    <label class="form-label" style="text-align: left;">{$aList.username}</label>
                </div>
                <div class="col-4"> </div>
            </div>
            <div class="row cl">
                <label class="form-label col-2"><span class="c-red">*</span>手机：</label>
                <div class="formControls col-5">
                    <input type="text" class="input-text" value="{$aList.telephone}" autocomplete="off" placeholder="" id="user-tel" name="telephone">
                </div>
                <div class="col-4"> </div>
            </div>
            <div class="row cl">
                <label class="form-label col-2"><span class="c-red">*</span>Email:</label>
                <div class="formControls col-5">
                    <input type="text" class="input-text" value="{$aList.email}" autocomplete="off" placeholder="" id="user-tel" name="email">
                </div>
                <div class="col-4"> </div>
            </div>
            <div class="row cl">
                <label class="form-label col-2">角色：</label>
                <div class="formControls col-5"> 
                   <label class="form-label" style="text-align: left;"> {$aList.rolename}</label>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-2">备注：</label>
                <div class="formControls col-5">
                    <textarea name="des" cols="" rows="" class="textarea" dragonfly="true" onKeyUp="textarealength(this,100)">{$aList.des}</textarea>
                    <p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>
                </div>
                <div class="col-4"> </div>
            </div>
            <div class="row cl">
                <div class="col-9 col-offset-2">
                    <input id="sub" onClick="subform();" class="btn btn-primary radius" type="button" value="&nbsp;&nbsp;保存&nbsp;&nbsp;">
                    <button id="cancle" onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                </div>
            </div>
            </form>
        </div>
        <div class="tabCon">
            <form class="form form-horizontal" id="form-admin-repassword">
            <div id="tab-system" class="HuiTab">
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>用户名：</label>
                    <div class="formControls col-xs-8 col-sm-9 callnum">
                        <label class="form-label" style="text-align: left;">{$aList.username}</label>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>密&nbsp;&nbsp;&nbsp;码：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="password" placeholder="" value="" class="input-text" name="oldpassword">
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>新 密 码：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="password" placeholder="" value="" class="input-text" name="password">
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>确认密码：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="password" placeholder="" value="" class="input-text" name="repassword">
                    </div>
                </div>
            <div class="row cl">
                <div class="col-9 col-offset-2">
                    <input id="reset" onClick="changePwd();" class="btn btn-primary radius" type="button" value="&nbsp;&nbsp;保存&nbsp;&nbsp;">
                    <button id="cancle" onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                </div>
            </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript" src="__PUBLIC__/lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/lib/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/lib/Validform/5.3.2/Validform.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/lib/layer/2.1/layer.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/H-ui.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/H-ui.admin.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/checkform.js"></script>
<script type="text/javascript">
$(function(){
    $('.skin-minimal input').iCheck({
        checkboxClass: 'icheckbox-blue',
        radioClass: 'iradio-blue',
        increaseArea: '20%'
    });

    $("#tab-system").Huitabs({
        index:0
    });

    $("select option").each(function(){
        if($(this).val()==$("select").attr('role')){ 
            $(this).attr("selected",true);
        }
    });
});
</script>
<script type="text/javascript">
// 提交基本信息
function subform()
{   
    var telephone = $.trim($("input[name='telephone']").val());
    if(telephone == ''){
        layer.msg("手机号码不能为空！",{icon:0,time:2000});
        $("input[name='telephone']").focus();
        return false;
    }else if(!telephone.isMobile()){
        layer.msg("请输入正确的手机号码！",{icon:0,time:2000});
        $("input[name='telephone']").focus();
        return false;
    }
    var email = $.trim($("input[name='email']").val());
    if(email == ''){
        layer.msg("email不能为空！",{icon:0,time:2000});
        $("input[name='email']").focus();
        return false;
    }else if(!email.isEmail()){
        layer.msg("请输入正确的Email！",{icon:0,time:2000});
        $("input[name='email']").focus();
        return false;
    }
    var des = $.trim($("textarea[name='des']").text());
    var id = $.trim($("input[name='id']").val());
    $.ajax({
        type:"post",
        url:"{:U('Person/person')}",
        data:$('#form-admin-edit').serialize(),
        success:function(data){
            if(data.flag == true){
                layer.msg(data.msg,{icon:1,time:2000});
                setTimeout(function(){
                    layer_close();
                },1500);
                return false;
            }else if(data.flag == false){
                layer.msg(data.msg,{icon:0,time:2000});
                return false;
            }else{
                layer.msg('未知错误！',{icon:0,time:2000});
                return false;
            }
        }
    });
}

function changePwd()
{
    var pwd =  $.trim($("input[name='oldpassword']").val());
    var newpwd = $.trim($("input[name='password']").val());
    var repwd = $.trim($("input[name='repassword']").val());
    if(pwd == '' || pwd == null){
        layer.msg("请输入原密码！",{icon:0,time:1200});
        $("input[name='oldpassword']").focus();
        return false;
    }else if(newpwd == '' || newpwd == null){
        layer.msg("请输入新密码！",{icon:0,time:1200});
        $("input[name='password']").focus();
        return false;
    }else if(newpwd.length < 6){
        layer.msg("新密码不能少于6位！",{icon:0,time:1200});
        $("input[name='password']").focus();
        return false;
    }
    else if(repwd == ''){
        layer.msg("请输入确认密码！",{icon:0,time:1200});
        $("input[name='repassword']").focus();
        return false;
    }else if(newpwd != repwd){
        layer.msg("请输入相同密码！",{icon:0,time:1200});
        $("input[name='password']").focus();
        return false;
    }
    else{
        $.ajax({
            type:"post",
            url:"{:U('Person/changepwd')}",
            data:"oldpassword="+pwd+"&password="+newpwd+"&repassword="+repwd,
            success:function(data){
                if(data.flag == true){
                    layer.msg(data.msg,{icon:1,time:1200});
                    setTimeout(function(){
                        layer_close();
                    },1300);
                    return false;
                }else if(data.flag == false){
                   layer.msg(data.msg,{icon:5,time:1200});
                   return false; 
                }else{
                    layer.msg("未知错误！",{icon:0,time:1200});
                    return false;
                }
            }
        });
    }
}
</script>
</body>
</html>